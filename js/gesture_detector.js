var GestureDetector=function(){function e(e,t){this.element=e,this.options=t||{},this.state=v,this.timers={}}function u(e){var t=e.timeStamp;return t>2*Date.now()?Math.floor(t/1e3):t}function a(e,t){return Object.freeze({screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,timeStamp:u(e)})}function f(e,t,r){return Object.freeze({screenX:n((t.screenX+r.screenX)/2),screenY:n((t.screenY+r.screenY)/2),clientX:n((t.clientX+r.clientX)/2),clientY:n((t.clientY+r.clientY)/2),timeStamp:u(e)})}function l(e){return Object.freeze({screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,timeStamp:u(e)})}function c(e,t){var n=t.screenX-e.screenX,i=t.screenY-e.screenY;return r(n*n+i*i)}function h(e,t){return i(t.screenY-e.screenY,t.screenX-e.screenX)*180/s}function p(e,t){var n=t-e;return n>180?n-=360:n<=-180&&(n+=360),n}function d(n,r){var i=t(r.screenX-n.screenX),s=t(r.screenY-n.screenY),o=r.timeStamp-n.timeStamp;return i<e.DOUBLE_TAP_DISTANCE&&s<e.DOUBLE_TAP_DISTANCE&&o<e.DOUBLE_TAP_TIME}e.prototype.startDetecting=function(){var e=this;o.forEach(function(t){e.element.addEventListener(t,e)})},e.prototype.stopDetecting=function(){var e=this;o.forEach(function(t){e.element.removeEventListener(t,e)})},e.prototype.handleEvent=function(e){var t=this.state[e.type];if(!t)return;if(e.changedTouches){e.type==="touchend"&&e.changedTouches.length>1&&console.warn("gesture_detector.js: spurious extra changed touch on touchend. See https://bugzilla.mozilla.org/show_bug.cgi?id=785554");for(var n=0;n<e.changedTouches.length;n++)t(this,e,e.changedTouches[n]),t=this.state[e.type]}else t(this,e)},e.prototype.startTimer=function(e,t){this.clearTimer(e);var n=this;this.timers[e]=setTimeout(function(){n.timers[e]=null;var t=n.state[e];t&&t(n,e)},t)},e.prototype.clearTimer=function(e){this.timers[e]&&(clearTimeout(this.timers[e]),this.timers[e]=null)},e.prototype.switchTo=function(e,t,n){this.state=e,e.init&&e.init(this,t,n)},e.prototype.emitEvent=function(e,t){if(!this.target){console.error("Attempt to emit event with no target");return}var n=this.element.ownerDocument.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),this.target.dispatchEvent(n)},e.HOLD_INTERVAL=1e3,e.PAN_THRESHOLD=50,e.MOUSE_PAN_THRESHOLD=25,e.DOUBLE_TAP_DISTANCE=50,e.DOUBLE_TAP_TIME=500,e.VELOCITY_SMOOTHING=.5,e.SCALE_THRESHOLD=40,e.ROTATE_THRESHOLD=22.5;var t=Math.abs,n=Math.floor,r=Math.sqrt,i=Math.atan2,s=Math.PI,o=["touchstart","touchmove","touchend","mousedown"],v={name:"initialState",init:function(e){e.target=null,e.start=e.last=null,e.touch1=e.touch2=null,e.vx=e.vy=null,e.startDistance=e.lastDistance=null,e.startDirection=e.lastDirection=null,e.lastMidpoint=null,e.scaled=e.rotated=null},touchstart:function(e,t,n){e.switchTo(m,t,n)},mousedown:function(e,t){e.switchTo(E,t)}},m={name:"touchStartedState",init:function(t,n,r){t.target=n.target,t.touch1=r.identifier,t.start=t.last=a(n,r),t.options.holdEvents&&t.startTimer("holdtimeout",e.HOLD_INTERVAL)},touchstart:function(e,t,n){e.clearTimer("holdtimeout"),e.switchTo(b,t,n)},touchmove:function(n,r,i){if(i.identifier!==n.touch1)return;if(t(i.screenX-n.start.screenX)>e.PAN_THRESHOLD||t(i.screenY-n.start.screenY)>e.PAN_THRESHOLD)n.clearTimer("holdtimeout"),n.switchTo(g,r,i)},touchend:function(e,t,n){if(n.identifier!==e.touch1)return;e.lastTap&&d(e.lastTap,e.start)?(e.emitEvent("tap",e.start),e.emitEvent("dbltap",e.start),e.lastTap=null):(e.emitEvent("tap",e.start),e.lastTap=a(t,n)),e.clearTimer("holdtimeout"),e.switchTo(v)},holdtimeout:function(e){e.switchTo(y)}},g={name:"panStartedState",init:function(e,t,n){t.type==="touchmove"&&g.touchmove(e,t,n)},touchmove:function(t,n,r){if(r.identifier!==t.touch1)return;var i=a(n,r);t.emitEvent("pan",{absolute:{dx:i.screenX-t.start.screenX,dy:i.screenY-t.start.screenY},relative:{dx:i.screenX-t.last.screenX,dy:i.screenY-t.last.screenY},position:i});var s=i.timeStamp-t.last.timeStamp,o=(i.screenX-t.last.screenX)/s,u=(i.screenY-t.last.screenY)/s;t.vx==null?(t.vx=o,t.vy=u):(t.vx=t.vx*e.VELOCITY_SMOOTHING+o*(1-e.VELOCITY_SMOOTHING),t.vy=t.vy*e.VELOCITY_SMOOTHING+u*(1-e.VELOCITY_SMOOTHING)),t.last=i},touchend:function(e,t,n){if(n.identifier!==e.touch1)return;var r=a(t,n),o=r.screenX-e.start.screenX,u=r.screenY-e.start.screenY,f=i(u,o)*180/s;f<0&&(f+=360);var l;f>=315||f<45?l="right":f>=45&&f<135?l="down":f>=135&&f<225?l="left":f>=225&&f<315&&(l="up"),e.emitEvent("swipe",{start:e.start,end:r,dx:o,dy:u,dt:t.timeStamp-e.start.timeStamp,vx:e.vx,vy:e.vy,direction:l,angle:f}),e.switchTo(v)}},y={name:"holdState",init:function(e){e.emitEvent("holdstart",e.start)},touchmove:function(e,t,n){var r=a(t,n);e.emitEvent("holdmove",{absolute:{dx:r.screenX-e.start.screenX,dy:r.screenY-e.start.screenY},relative:{dx:r.screenX-e.last.screenX,dy:r.screenY-e.last.screenY},position:r}),e.last=r},touchend:function(e,t,n){var r=a(t,n);e.emitEvent("holdend",{start:e.start,end:r,dx:r.screenX-e.start.screenX,dy:r.screenY-e.start.screenY}),e.switchTo(v)}},b={name:"transformState",init:function(e,t,n){e.touch2=n.identifier;var r=t.touches.identifiedTouch(e.touch1),i=t.touches.identifiedTouch(e.touch2);e.startDistance=e.lastDistance=c(r,i),e.startDirection=e.lastDirection=h(r,i),e.scaled=e.rotated=!1},touchmove:function(n,r,i){if(i.identifier!==n.touch1&&i.identifier!==n.touch2)return;var s=r.touches.identifiedTouch(n.touch1),o=r.touches.identifiedTouch(n.touch2),u=f(r,s,o),a=c(s,o),l=h(s,o),d=p(n.startDirection,l);n.scaled||(t(a-n.startDistance)>e.SCALE_THRESHOLD?n.scaled=!0:a=n.startDistance),n.rotated||(t(d)>e.ROTATE_THRESHOLD?n.rotated=!0:l=n.startDirection);if(n.scaled||n.rotated)n.emitEvent("transform",{absolute:{scale:a/n.startDistance,rotate:p(n.startDirection,l)},relative:{scale:a/n.lastDistance,rotate:p(n.lastDirection,l)},midpoint:u}),n.lastDistance=a,n.lastDirection=l,n.lastMidpoint=u},touchend:function(e,t,n){if(n.identifier===e.touch2)e.touch2=null;else{if(n.identifier!==e.touch1)return;e.touch1=e.touch2,e.touch2=null}(e.scaled||e.rotated)&&e.emitEvent("transformend",{absolute:{scale:e.lastDistance/e.startDistance,rotate:p(e.startDirection,e.lastDirection)},relative:{scale:1,rotate:0},midpoint:e.lastMidpoint}),e.switchTo(w)}},w={name:"afterTransformState",touchstart:function(e,t,n){e.switchTo(b,t,n)},touchend:function(e,t,n){n.identifier===e.touch1&&e.switchTo(v)}},E={name:"mouseDownState",init:function(t,n){t.target=n.target;var r=t.element.ownerDocument;r.addEventListener("mousemove",t,!0),r.addEventListener("mouseup",t,!0),t.start=t.last=l(n),t.options.holdEvents&&t.startTimer("holdtimeout",e.HOLD_INTERVAL)},mousemove:function(n,r){if(t(r.screenX-n.start.screenX)>e.MOUSE_PAN_THRESHOLD||t(r.screenY-n.start.screenY)>e.MOUSE_PAN_THRESHOLD)n.clearTimer("holdtimeout"),n.switchTo(x,r)},mouseup:function(e,t){var n=e.element.ownerDocument;n.removeEventListener("mousemove",e,!0),n.removeEventListener("mouseup",e,!0),e.lastTap&&d(e.lastTap,e.start)?(e.emitEvent("tap",e.start),e.emitEvent("dbltap",e.start),e.lastTap=null):(e.emitEvent("tap",e.start),e.lastTap=l(t)),e.clearTimer("holdtimeout"),e.switchTo(v)},holdtimeout:function(e){e.switchTo(S)}},S={name:"mouseHoldState",init:function(e){e.emitEvent("holdstart",e.start)},mousemove:function(e,t){var n=l(t);e.emitEvent("holdmove",{absolute:{dx:n.screenX-e.start.screenX,dy:n.screenY-e.start.screenY},relative:{dx:n.screenX-e.last.screenX,dy:n.screenY-e.last.screenY},position:n}),e.last=n},mouseup:function(e,t){var n=l(t);e.emitEvent("holdend",{start:e.start,end:n,dx:n.screenX-e.start.screenX,dy:n.screenY-e.start.screenY}),e.switchTo(v)}},x={name:"mousePannedState",init:function(e,t){t.type==="mousemove"&&x.mousemove(e,t)},mousemove:function(t,n){var r=l(n);t.emitEvent("pan",{absolute:{dx:r.screenX-t.start.screenX,dy:r.screenY-t.start.screenY},relative:{dx:r.screenX-t.last.screenX,dy:r.screenY-t.last.screenY},position:r});var i=r.timeStamp-t.last.timeStamp,s=(r.screenX-t.last.screenX)/i,o=(r.screenY-t.last.screenY)/i;t.vx==null?(t.vx=s,t.vy=o):(t.vx=t.vx*e.VELOCITY_SMOOTHING+s*(1-e.VELOCITY_SMOOTHING),t.vy=t.vy*e.VELOCITY_SMOOTHING+o*(1-e.VELOCITY_SMOOTHING)),t.last=r},mouseup:function(e,t){var n=e.element.ownerDocument;n.removeEventListener("mousemove",e,!0),n.removeEventListener("mouseup",e,!0);var r=l(t),o=r.screenX-e.start.screenX,u=r.screenY-e.start.screenY,a=i(u,o)*180/s;a<0&&(a+=360);var f;a>=315||a<45?f="right":a>=45&&a<135?f="down":a>=135&&a<225?f="left":a>=225&&a<315&&(f="up"),e.emitEvent("swipe",{start:e.start,end:r,dx:o,dy:u,dt:r.timeStamp-e.start.timeStamp,vx:e.vx,vy:e.vy,direction:f,angle:a}),e.switchTo(v)}};return e}()